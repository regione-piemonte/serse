<!--
 * @license
 *
 * Copyright © 2025 Regione Piemonte
 *
 * Licensed under the EUPL, Version 1.2 or – as soon they will be
 * approved by the European Commission - subsequent versions of the
 * EUPL (the "Licence");
 *
 * You may not use this work except in compliance with the Licence.
 * You may obtain a copy of the Licence at:
 *
 * https://interoperable-europe.ec.europa.eu/collection/eupl/eupl-text-eupl-12
 * or
 * https://opensource.org/license/EUPL-1.2
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the Licence is distributed on an "AS IS" basis,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the Licence for the specific language governing permissions and
 * limitations under the Licence.
 -->

<mat-card-header class="mt-3">
  <mat-card-title>
    <h5>Associazione modello di intervento</h5>
  </mat-card-title>
</mat-card-header>

<mat-card-content class="ps-5 pe-5 mt-3">
<ng-container *ngIf="!modelloAssociato; else showModello">
    Nessun modello di intervento associato
  <hr>
</ng-container>
<ng-template #showModello>
  <div class="container-fluid" role="table">
    <div class="row border-bottom mb-2" role="rowheader">
      <div class="col-1"><Strong>Identificativo</Strong></div>
      <div class="col-2"><Strong>Titolo</Strong></div>
      <div class="col-3"><Strong>Soggetto attuatore</Strong></div>
      <div class="col-4"><Strong>Soggetto beneficario</Strong></div>
      <div class="col-1"><Strong>Istanza candidatura</Strong></div>
      <div class="col-1"></div>
    </div>
    <div class="row align-items-center" role="row">
      <div class="col-1"> {{modelloAssociato!.modelloIntervento!.idModelloIntervento}} </div>
      <div class="col-2"> {{modelloAssociato!.modelloIntervento!.titolo}} </div>
      <div class="col-3">
        {{modelloAssociato!.modelloIntervento!.soggettoAttuatore!.gruppoOperatore}}{{modelloAssociato!.modelloIntervento!.soggettoAttuatore!.codOperatore}}
        -
        {{modelloAssociato!.denominazioneSoggettoAttuatore}}</div>
      <div class="col-4">
        {{modelloAssociato!.soggettoBeneficiario!.gruppoOperatore}}{{modelloAssociato!.soggettoBeneficiario!.codOperatore}}
        -
        {{modelloAssociato!.soggettoBeneficiario!.denominazione}}</div>
      <div class="col-1"> {{modelloAssociato!.modelloIntervento!.soggettoAttuatore!.modelId}}</div>
      <div class="col-1">
        <button *ngIf="canDisassocia"
          mat-icon-button
          aria-label="Disassocia Modello di intervento "
          (click)="onDisassocia()"
          class="btn--plain-text--danger"
          matTooltip="Disassocia Modello di intervento">
          <mat-icon>{{trashIcon}}</mat-icon>
        </button></div>
    </div>
  </div>
</ng-template>
</mat-card-content>



<mat-card-actions [align]="'start'">
  <button *ngIf="canAssoccia && !modelloAssociato"
          mat-button
          class="btn-link--primary"
          aria-label="associa modello di intervento"
          (click)="apriModale()">
    ASSOCIA MODELLO DI INTERVENTO
  </button>
</mat-card-actions>


<!-- ------------------------------------------------------------------------------- -->
<!-- Modale -->
<ng-template #associazione>
  <h2 mat-dialog-title>Associazione modello di intervento</h2>
  <hr>

  <div class="row">
    <div class="col-4">
      <mat-radio-group [formControl]="radioControl">
        <mat-radio-button class="m-2" value="1">I miei modelli</mat-radio-button>
        <mat-radio-button class="m-2" value="2">Tutti</mat-radio-button>
      </mat-radio-group>
    </div>
    <div class="col-4">
      <span>Istanza di candidatura selezionata: <strong>{{istanzaCandidatura!.modelId}} - {{istanzaCandidatura!.gruppoOperatore}}{{istanzaCandidatura!.codOperatore}}</strong></span>
    </div>
    <div class="col-4">
      <span>Tipo di intervento: <strong>{{tipoIntervento!.descrizione}}</strong></span>
    </div>
  </div>
  <div class="row">
     <!-- tipologia servizio-->
    <div class="col-md-12 col-sm-12">
      <mat-form-field style="width: 100%;" appearance="legacy">
        <mat-label>Selezionare una tipologia di servizio</mat-label>
        <mat-select [formControl]="tipoServizioControl">
          <mat-option>---</mat-option>
          <mat-option *ngFor="let tipologia of tipologiaServizioList; index as i" [value]="i">
            {{tipologia.codiceServizioRegionale}}-{{tipologia.descrServizioRegionale}} </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- ente -->
    <div class="col-md-6 col-sm-12">
      <mat-form-field style="width: 100%;" appearance="legacy">
        <mat-label>Ente coinvolto</mat-label>
        <input matInput [formControl]="enteControl">
      </mat-form-field>
      <mat-error *ngIf="!enteControl.valid">{{enteMessage}}</mat-error>
    </div>

    <!-- identificativo -->
    <div class="col-md-6 col-sm-12">
      <mat-form-field style="width: 100%;" appearance="legacy">
        <mat-label>Identificativo</mat-label>
        <input matInput type="text" [formControl]="identificativoControl" placeholder="99999"
          [textMask]="{mask:identificativoMask, guide:false}">
      </mat-form-field>
    </div>
  </div>
  <div class="row justify-content-between">
    <div class="ms-auto col-auto">
      <button class="btn btn--primary" aria-label="cerca modelli di intervento" (click)="onCerca()">CERCA</button>
    </div>
  </div>
  <div mat-dialog-content
        style="min-height: 350px; max-height: 350px;">


    <div *ngIf="visibleTable"
          class="row">
      <app-table #table
                [buttonList]="buttonsTabella"
                [rowData]="rowData"
                [tableSettings]="tableSettings"
                [columnList]="columnList"
                [keepPagination]="true">
      </app-table>
    </div>
  </div>

  <mat-divider></mat-divider>
  <mat-dialog-actions class="d-flex justify-content-between">
     <button mat-dialog-close
            mat-raised-button
            class="btn btn--outline-primary">ANNULLA</button>
    <div  [matTooltip]="'Selezionare un riga sulla tabella per procedere'"
          [matTooltipPosition]="'above'">
    <button mat-button
            class="btn btn--primary"
            aria-label="associa selezionato"
            (click)="onConfermaModale()"
            [disabled]="!visibleTable">
      Conferma
    </button>
    </div>
  </mat-dialog-actions>
</ng-template>
