<!--
 * @license
 *
 * Copyright © 2025 Regione Piemonte
 *
 * Licensed under the EUPL, Version 1.2 or – as soon they will be
 * approved by the European Commission - subsequent versions of the
 * EUPL (the "Licence");
 *
 * You may not use this work except in compliance with the Licence.
 * You may obtain a copy of the Licence at:
 *
 * https://interoperable-europe.ec.europa.eu/collection/eupl/eupl-text-eupl-12
 * or
 * https://opensource.org/license/EUPL-1.2
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the Licence is distributed on an "AS IS" basis,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the Licence for the specific language governing permissions and
 * limitations under the Licence.
 -->

<mat-card class="border mb-2">

<mat-card-header>
  <h5 mat-card-title>
    Tipologie di servizi
  </h5>
</mat-card-header>
<mat-divider></mat-divider>

<mat-card-content
  class="ps-5 mt-3">
<ng-container *ngIf="!tipologieServizi.length; else tipologieContent">
    Nessun tipologia di servizio presente
    <hr>
</ng-container>
<ng-template #tipologieContent>
  <div class="row pe-5 align-items-center" *ngFor="let tipologia of tipologie">
    <div class="col-xl-7 col"> {{tipologia.descrizione }}  </div>
    <div class="col-xl-1 col"> {{tipologia.tipo }} </div>
    <div class="col-xl-1 col"> {{tipologia.finalita}} </div>
    <div class="col-xl-1 col"> {{tipologia.durata}} ore</div>
    <div class="col-xl-2 col">
      <ng-container *ngIf="tipologia.icons">
        <ng-container *ngIf="isModificabileEsterni; else soloView">
          <button mat-icon-button
                  [matTooltip]="icons[0].matTooltip"
                  (click)="icons[0].actionClick!(tipologia.idServizioModello)"
                  attr.aria-label={{icons[0].ariaLabel}}
                  [ngClass]="icons[0].cssClass">
              <mat-icon> {{icons[0].matIcon}} </mat-icon>
          </button>
          <button mat-icon-button
                  [matTooltip]="icons[1].matTooltip"
                  (click)="icons[1].actionClick!(tipologia.idServizioModello)"
                  attr.aria-label={{icons[1].ariaLabel}}
                  [ngClass]="icons[1].cssClass">
              <mat-icon> {{icons[1].matIcon}} </mat-icon>
          </button>
        </ng-container>
        <ng-template #soloView>
          <button mat-icon-button
                  [matTooltip]="icons[2].matTooltip"
                  (click)="icons[2].actionClick!(tipologia.idServizioModello)"
                  attr.aria-label={{icons[2].ariaLabel}}
                  [ngClass]="icons[2].cssClass">
              <mat-icon> {{icons[2].matIcon}} </mat-icon>
          </button>
        </ng-template>
      </ng-container>
    </div>
    <hr>
  </div>
</ng-template>
</mat-card-content>
<mat-divider></mat-divider>
<mat-card-actions
    [align]="'start'">
    <button *ngIf="isModificabile==true"
            mat-button
            class="btn-link--primary"
            aria-label="gestisci tipologie di servizi regionali"
            (click)="openRegionali()">
      GESTISCI TIPOLOGIE DI SERVIZI REGIONALI
    </button>
  <button   *ngIf="isModificabileEsterni"
            mat-button
            class="ms-3"
            class="btn-link--primary"
            aria-label="aggiungi tipologia di servizio esterno"
            (click)="apriModaleEsterni(true)">
      AGGIUNGI TIPOLOGIA DI SERVIZI ESTERNI
    </button>

</mat-card-actions>

</mat-card>

<!-- ################################################################## -->
<!-- Regionali -->
<ng-template #regionali>
<h2 mat-dialog-title>Tipologia di servizi regionali</h2>
<hr>
<section mat-dialog-content
          class="dialog-content">
  <span class="example-list-section">
    <mat-checkbox class="example-margin"
                  [checked]="allComplete"
                  [indeterminate]="someComplete()"
                  (change)="setAll($event.checked)">
      <strong>Seleziona tutti</strong>
    </mat-checkbox>
  </span>
  <hr>
  <span class="example-list-section">
  <div class="container">

    <div *ngFor="let tipologia of tipologieRegionaliCheck" class="row">
      <div class="col-6">
        <mat-checkbox
          [(ngModel)]="tipologia.check"
          (ngModelChange)="updateAllComplete()"
          >
        </mat-checkbox>
        {{tipologia.codice}}
        {{tipologia.descrizione}}
      </div>
      <div class="col-4">
        {{tipologia.finalita ? tipologia.finalita: "nessuna finalita' assegnata"}}
      </div>
      <div class="col">
        {{tipologia.durata}} Ore
      </div>
      <hr>
    </div>

  </div>
  </span>
</section>

<div  mat-dialog-actions
      [align]="'end'"
      class="d-flex justify-content-between mt-3">

  <div class="p-2">
    <button mat-dialog-close mat-button  class="btn btn--outline-primary" aria-label="annulla">ANNULLA</button>
  </div>
  <div class="p-2">
    <button mat-dialog-close
          mat-raised-button
          class="btn btn--primary"
          aria-label="conferma aggiornamento tipologie servizi regionali"
          (click)="aggiornaRegionali()">CONFERMA</button>
  </div>
</div>
</ng-template>



<!-- ################################################################## -->
<!-- Esterni -->
<ng-template #esterni>

<form [formGroup]="form">
<!-- Tipologia di servizi esterni -->
<div>
<h2 mat-dialog-title>Tipologia di servizi esterni</h2>
<hr>
<form [formGroup]="datiForm">
<mat-dialog-content>
<!-- Denominazione -->
<div class="row">
  <mat-form-field appearance="legacy">
    <mat-label>Titolo</mat-label>
    <input matInput
          formControlName="denominazione"
          maxlength="100">
  </mat-form-field>
</div>
<!-- Descrizione -->
<div class="row">
  <mat-form-field appearance="legacy">
    <mat-label>Descrizione</mat-label>
    <textarea matInput
              formControlName="descrizione"
              maxlength="2000"></textarea>
  </mat-form-field>
</div>
<!-- finalità  -->
<div class="row">
  <div class="col-6">
    <mat-form-field appearance="legacy" style="width: 100%;">
      <mat-label>Selezionare una finalità</mat-label>
      <mat-select formControlName="finalita">
        <mat-option value="I">Servizio individuale</mat-option>
        <mat-option value="G">Servizio di gruppo</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
</div>

<!-- Durata in ore | attore esterno di riferimento  -->
<div class="row">
  <div class="col-6">
    <mat-form-field style="width: 100%;" appearance="legacy">
      <mat-label>Durata in ore*</mat-label>
      <input matInput
              formControlName="durata"
              maxlength="6">
      <mat-error>
        <app-control-messages [control]="datiForm.controls['durata']|castFromControl"></app-control-messages>
      </mat-error>
    </mat-form-field>
  </div>
  <div class="col-6">
    <mat-form-field style="width: 100%;" appearance="legacy">
      <mat-label>Attore esterno di riferimento</mat-label>
      <input matInput
              formControlName="attore"
              maxlength="250">
    </mat-form-field>
  </div>
</div>
<div class="mb-3"></div>
</mat-dialog-content>
</form>
</div>
<hr>

<!-- Riferimenti -->

<!-- Form -->
<app-dati-riferimento
      [formGrup]="riferimentoForm">
</app-dati-riferimento>
</form>

<div mat-dialog-action
      [align]="'end'"
      class="d-flex justify-content-between mt-3"
    *ngIf="!form.disabled">
  <div class="p-2">
    <button mat-dialog-close
            mat-button
            class="btn btn--outline-primary" aria-label="annulla">ANNULLA</button>
  </div>
  <div class="p-2">
    <button mat-raised-button
      class="btn btn--primary"
      (click)="onConfermaEsterno()"
      aria-label="conferma tipologia servizio esterno">CONFERMA</button>
  </div>
</div>
<div mat-dialog-action
    [align]="'end'"
    class="d-flex mt-3"
    *ngIf="form.disabled">
<div class="ms-auto p-2">
  <button mat-raised-button
          mat-dialog-close
          class="btn btn--outline-primary"
          role="alertdialog"
          (click)="enableForm()">CHIUDI</button>
</div>
</div>

</ng-template>


